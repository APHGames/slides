include ../mixins/containers.pug
include ../mixins/containers_aph.pug

- var imgAssets = '../assets/physics_engines/';
- var defaultBgr = 'backgrounds/physics.jpg';

+mchapter('Physics Engine', imgAssets+'chapter_physics.svg')
+frameInbox('Physics engine')
	.important-green
		.bottom-0.right-0
			img.height-400(src=imgAssets+'physics_01.png')
		ul
			li.fragment system that <span class="highlight">approximates</span> physical phenomena in real-time
			li.mt-40.upside.fragment can improve immersion
			li.downside.fragment can broke the game story
			li.fragment.highlight Flow
				.bottom-40.left-220
					img.height-500(src=imgAssets+'physics_flow.svg')
+frameInbox('Physics Engines')
	div.spacing-4xs
		.scope.fragment
			p N-Collide
			ul
				li.fragment 2D/3D collision detection library written in Rust
		.scope.fragment
			p Box2D
			ul
				li.fragment open-source C++ 2D physics engine
				li.fragment supports CCD (continuous collision detection)
		.scope.fragment
			p Bullet
			ul
				li.fragment open-source 3D physics engine
				li.fragment supports CCD
		.scope.fragment
			p PhysX
			ul
				li.fragment NVidia GPU engine
				li.fragment PhysX destruction, PhysX clothing, PhysX particles
		.scope.fragment
			p p2.js
			ul
				li.fragment module JavaScript engine, supports CCD
		.scope.fragment
			p Havok
			ul
				li.fragment gold commercial standard
		.bottom-0.right-0
			img.height-500(src=imgAssets+'physics_03.png')
+frameInbox('Physics and animation')
	.important-green
		ul
			li.highlight.fragment(data-fragment-index='1') physics 
				include ../../assets/physics_engines/equations_generated/animation.svg
				|&nbsp;animation!
			li.fragment(data-fragment-index='2') animations must cooperate with physics engine to run seamlessly
			li.fragment(data-fragment-index='3') cut-scenes and state-transition animations are detached from physics
			li.fragment(data-fragment-index='4') <span class="highlight-2">physics-based interactions</span> - animations generated by physics engine
			li.fragment(data-fragment-index='5') almost all AAA games still use static animations connected to the physical environment
		.space-xl
		.flex-cols-3.ml-100.fragment(data-fragment-index='1')
			div.text-center
				img.height-280(src=imgAssets+'animation.gif')
			div.text-center
				img.height-280(src=imgAssets+'animation02.gif')
			div
				img.height-280(src=imgAssets+'animation03.gif')
+frameInbox('Physics engine features')
	div
		ul.spacing-3xs
			li.fragment collision detection
			li.fragment contact callbacks
			li.fragment joints
			li.fragment concave and convex hulls
			li.fragment compound bodies
			li.fragment sleeping objects
			li.fragment raycasting, shapecasting
			li.fragment deformable structures
			li.fragment destructible structures
			li.fragment trigger volumes
			li.fragment complex machines
			li.fragment drivable vehicles
			li.fragment rag doll characters
			li.fragment water surface, hair, cloth
			li.fragment particles
	.bottom-20.right-20
		img.height-500(src=imgAssets+'skyrim.jpg')
+frameInbox('Physics in games')
	div
		.scope.fragment(data-fragment-index='1')
			p Pinballs (1980+)
			ul
				li non-trivial OBB collision detection
		.scope.fragment(data-fragment-index='2')
			p The Incredible Machine (1993)
			ul
				li advanced physical interactions
		.scope.fragment(data-fragment-index='3')
			p Worms (1995)
			ul
				li pixel-level environment interaction
		.scope.fragment(data-fragment-index='4')
			p Half-Life 2 (2004)
			ul
				li destructible environment, liquid physics
		.top-20.right-20.fragment(data-fragment-index='1')
			img.height-300(src=imgAssets+'pinball.gif')
		.top-170.right-430.fragment(data-fragment-index='2')
			img.height-300(src=imgAssets+'incredible_machine.png')
		.top-280.right-20.fragment(data-fragment-index='3')
			img.height-350(src=imgAssets+'worms.png')
		.bottom-0.right-370.fragment(data-fragment-index='4')
			img.height-400(src=imgAssets+'half-life2.jpg')
+frameInbox('Physics in games')
	div.spacing-3xs
		.scope.fragment(data-fragment-index='1')
			p Angry Birds (2009)
			ul
				li physics as the core mechanic
		.scope.fragment(data-fragment-index='2')
			p INSIDE (2016)
			ul
				li soft-bodies driven by a network of impulses
		.scope.fragment(data-fragment-index='3')
			p Half-Life Alyx (2020)
			ul
				li physics-based interactions
		.scope.fragment(data-fragment-index='4')
			p Noita (2020)
			ul
				li pixel-level physics simulation
		.top-20.right-20.fragment(data-fragment-index='1')
			img.height-400(src=imgAssets+'angry_birds.png')
		.top-170.right-370.fragment(data-fragment-index='2')
			img.height-280(src=imgAssets+'inside.gif')
		.top-340.right-20.fragment(data-fragment-index='3')
			img.height-300(src=imgAssets+'half-life-alyx.jpg')
		.bottom-0.right-370.fragment(data-fragment-index='4')
			img.height-350(src=imgAssets+'noita.jpg')
+frameInbox('Object types')
	.important-orange.spacing-3xs
		.scope.fragment
			p Body
			ul
				li.fragment fundamental object in the physics scene
		.scope.fragment
			p Rigid Body
			ul
				li.fragment idealized, infinitely hard, non-deformable solid object
				li.fragment <span class="highlight-2">physics-driven bodies</span> - driven entirely by the simulation
				li.fragment <span class="highlight-2">game-driven bodies</span> - moved in a non-physical way (animations)
				li.fragment <span class="highlight-2">fixed bodies</span> - collision-only bodies (e.g. triggers)
		.scope.fragment
			p Soft body
			ul
				li.fragment deformable
		.scope.fragment
			p Shape
			ul
				li.fragment region of space described by a boundary, with a definite inside and outside (curved line, polygon, curved surface, polyhedron)
		.scope.fragment
			p Fixture
			ul
				li.fragment used to describe size, shape and material properties
		.right-50.top-250
			img.height-350(src=imgAssets+'cube.png')
+frameInbox('Object Types')
	.important-orange
		.scope.fragment
			p Constraint
			ul
				li.fragment connects bodies together in order to simulate interaction (ropes, wheels, vehicles, chains)
		.scope.fragment
			p Sensor/Phantom
			ul
				li.fragment entity that provides a feedback when certain objects overlap
				li.fragment participates on collision detection but doesn't affect the scene
		.scope.fragment
			p Rag doll
			ul
				li.fragment displays human-like figures with a realistic motion
		.scope.fragment
			p Destructible object
			ul
				li.fragment breakable object, can be implemented by using rigid body dynamics, dividing the model into a number of breakable pieces
+frameInbox('Constraints')
	.important-green
		ul
			li.fragment <span class="highlight">Revolute</span> - a hinge or pin, where the bodies rotate
				ul
					li.fragment wheels, chains, rotating doors, catapults, levers
			li.fragment <span class="highlight">Distance</span> - a point on each body will be kept at a fixed distance apart
			li.fragment <span class="highlight">Rope</span> - restricts the maximum distance between two points
			li.fragment <span class="highlight">Prismatic</span> - body's motion is restricted to a single degree of freedom
				ul
					li.fragment elevators, sliding doors, pistons
			li.fragment <span class="highlight">Weld</span> - holds the bodies at the same orientation
			li.fragment <span class="highlight">Cone-Twist</span> - adds a cone and twist axis limits (6 degrees of freedom)
			li.fragment <span class="highlight">Gear</span> - controls two other joints so that the movement of one affects the other
			li.fragment <span class="highlight">Motor</span> - joint with torque or angular impulses
		.bottom-0.right-460
			img.height-230(src=imgAssets+'car.svg')
+frameInbox('Constraints')
	.important-orange
	.flex.flex-row.justify-evenly.center
		figure.fragment
			img.height-500(src=imgAssets+'constraint_rope.svg')
			p rope
		figure.fragment
			img.height-500(src=imgAssets+'constraint_revolute.svg')
			p revolute
		figure.fragment
			img.height-500(src=imgAssets+'constraint_prismatic.svg')
			p prismatic
		figure.fragment
			img.height-500(src=imgAssets+'constraint_conetwist.svg')
			p cone-twist
+frameInbox('Constraints')
	div
		.top-170.left-350
			img.height-680(src=imgAssets+'joints.jpg')
		.top-130.left-10
			img.height-580(src=imgAssets+'constraints.svg')
+frameInbox('Fracturing')
	div
		ul
			li.fragment breaking an object into smaller fragments
			li.fragment in many cases destruction is not dynamic (can be made using animations)
			li.fragment techniques: manual fracturing, Voronoi Shattering, voxels
		.bottom-0.right-0.width-100p
			img.width-100p.radius-3(src=imgAssets+'fracturing.png')
		.bottom-150.flex.flex-row
			figure.mx-10.fragment
				img.height-310(src=imgAssets+'paratrooper.png')
				p.bgr-rhino-100.p-5 Paratrooper (1982)
			figure.mx-10.fragment
				img.height-310(src=imgAssets+'fictorium.jpg')
				p.bgr-rhino-100.p-5 Fictorium (2017)
			figure.mx-10.fragment
				img.height-310(src=imgAssets+'teardown.jpg')
				p.bgr-rhino-100.p-5 Teardown (2020)
+frameInbox('Particle Systems')
	.important-orange
		ul
			li.fragment a collection of point masses that obeys certain physical laws
			li.fragment can model complex fuzzy shapes and dynamics
			li.fragment uses Flyweight pattern (array of positions, velocities, group lists)
			li.fragment particles are not only moving points! Even a tree may become a particle
		.scope.fragment.mt-30
			p Applications
			ul.leading-md
				li.highlight-2.fragment fluids
				li.fragment visual effects
				li.fragment flocks
				li.fragment rendered trails (plants)
				li.fragment soft bodies (flag, cloth)
		.right-20.bottom-150
			img.height-400(src=imgAssets+'particles.gif')
		.right-350.bottom-150
			img.height-400(src=imgAssets+'flame.gif')
+frameInbox('Soft bodies and liquids')
	.important-green
		ul
			li.fragment usually implemented as a combination of particle systems and visual effects
			li.fragment <span class="highlight">common model:</span>
				ol
					li.fragment apply collision detection upon particles
					li.fragment apply pressure and repulsive forces
					li.fragment update positions
					li.highlight-2.fragment handle interaction with other objects
		.right-0.bottom-0
			img.height-400(src=imgAssets+'softbody.gif')
		.left-100.bottom-30
			img.height-350(src=imgAssets+'liquid.jpg')
+frameInbox('Example: CryEngine Fluid Physics')
	div
		ul
			li.fragment utterly complex
			li.fragment 5000+ lines of code for just the RigidBody part
			li.fragment very poor code quality
				.code.text-xs.mt-20
					include ../../assets/physics_engines/snippets_generated/cryengine.html
		.bottom-20.right-20
			img.height-770(src=imgAssets+'cryengine_physics.png')